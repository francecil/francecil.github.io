(window.webpackJsonp=window.webpackJsonp||[]).push([[347],{1134:function(_,e,v){"use strict";v.r(e);var o=v(30),a=Object(o.a)({},(function(){var _=this,e=_._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("p",[_._v("user (id,name,role_id)")]),_._v(" "),e("p",[_._v("role (id,name)")]),_._v(" "),e("ol",[e("li",[_._v("查找role列表每个role_id在user的个数")])]),_._v(" "),e("blockquote",[e("p",[e("code",[_._v("SELECT *,(SELECT count(*) from user where user.role_id = role.id) as num from role")])])]),_._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[_._v("提供"),e("code",[_._v("user.id")]),_._v("列表(1,2,3)和"),e("code",[_._v("role_id")]),_._v(" 6 ,判断"),e("code",[_._v("user.id")]),_._v("列表的"),e("code",[_._v("role_id")]),_._v("是否都是6")])]),_._v(" "),e("blockquote",[e("p",[e("code",[_._v("SELECT count(*) as sum FROM user where id in (1,2,3) and role_id=6")])]),_._v(" "),e("p",[_._v("sum!=list.length，说明存在其他"),e("code",[_._v("role_id")]),_._v("的user,或者user记录本身不存在,输出false。")]),_._v(" "),e("p",[_._v("否则输出true")])]),_._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[_._v("根据查询结果批量插入")])]),_._v(" "),e("blockquote",[e("p",[_._v("无需用VALUES")])]),_._v(" "),e("p",[e("code",[_._v("INSERT INTO form_channel(form_no,channel_no) (select form_no,channel_no from form_list)")])]),_._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[_._v("表单、渠道、应用记录、应用服务信息")])]),_._v(" "),e("p",[_._v("##　创建表单")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("form_list")]),_._v("：记录表单详情信息"),e("code",[_._v("form_no,state,company_id")])]),_._v(" "),e("li",[e("code",[_._v("form_channel")]),_._v(": 记录表单绑定了哪些渠道"),e("code",[_._v("form_no,channel_no")])]),_._v(" "),e("li",[e("code",[_._v("form_game_list")]),_._v(": 记录表单中所有应用的详情信息"),e("code",[_._v("game_no,form_no,state")])])]),_._v(" "),e("h2",{attrs:{id:"审核中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#审核中"}},[_._v("#")]),_._v(" 审核中")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("form_game_list")]),_._v(":state=>'审核中'")]),_._v(" "),e("li",[e("code",[_._v("game_list")]),_._v(":valid：-1,1,0 分别表示未开通/正服务/已挂起；"),e("code",[_._v("game_no")]),_._v("主键；")]),_._v(" "),e("li",[_._v("不存在"),e("code",[_._v("package_name,company_id")]),_._v("记录，则此时插入valid=-1，channel_no为null,"),e("code",[_._v("game_ref_ing_no")]),_._v("字段指向"),e("code",[_._v("form_game_list")]),_._v("表中的审核中记录的 "),e("code",[_._v("game_no")])]),_._v(" "),e("li",[_._v("存在"),e("code",[_._v("package_name,company_id")]),_._v("记录，更新"),e("code",[_._v("game_ref_ing_no")]),_._v("字段，此时该应用所属渠道还是之前审核通过的")]),_._v(" "),e("li",[e("code",[_._v("form_channel")]),_._v(":修改表单的渠道配置操作")])]),_._v(" "),e("h2",{attrs:{id:"审核通过"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#审核通过"}},[_._v("#")]),_._v(" 审核通过")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("form_game_list")]),_._v(":state=>'审核通过'")]),_._v(" "),e("li",[e("code",[_._v("game_list")]),_._v(": 删除"),e("code",[_._v("package_name,company_id")]),_._v("的记录，插入对应渠道列表的记录，并设置"),e("code",[_._v("game_ref_ed_no")])])]),_._v(" "),e("h2",{attrs:{id:"暂不支持"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#暂不支持"}},[_._v("#")]),_._v(" 暂不支持")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("form_game_list")]),_._v(":state=>'暂不支持'")]),_._v(" "),e("li",[e("code",[_._v("game_list")]),_._v(": 不做操作")])]),_._v(" "),e("p",[_._v("判断状态是审核还是升级就看是否存在"),e("code",[_._v("game_ref_ed_no")]),_._v("，增加state字段设置，方便查询")]),_._v(" "),e("h2",{attrs:{id:"关闭、开启服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭、开启服务"}},[_._v("#")]),_._v(" 关闭、开启服务")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("game_list")]),_._v(": 设置多个渠道的记录其"),e("code",[_._v("valid=0/1")]),_._v("=》正服务、已挂起")])]),_._v(" "),e("h2",{attrs:{id:"修改服务的渠道配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改服务的渠道配置"}},[_._v("#")]),_._v(" 修改服务的渠道配置")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("game_list")]),_._v(": 只有该服务拥有"),e("code",[_._v("game_ref_ed_no")]),_._v("值，才可以修改。删除之前记录，新增对应渠道记录")])]),_._v(" "),e("h2",{attrs:{id:"查看版本记录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看版本记录"}},[_._v("#")]),_._v(" 查看版本记录")]),_._v(" "),e("p",[e("code",[_._v("package_name,company_id")]),_._v(" 去"),e("code",[_._v("form_game_list")]),_._v("中取")]),_._v(" "),e("h2",{attrs:{id:"修改服务信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改服务信息"}},[_._v("#")]),_._v(" 修改服务信息")]),_._v(" "),e("p",[_._v("ref_ed指向的一定是审核通过的\n初次提交->审核中 "),e("code",[_._v("一条无channelNo,无ref_ed,有ref_ing的记录")]),_._v("\n暂不支持->审核失败 "),e("code",[_._v("之前记录无ref_ed,已存在ref_ing，处于未开通状态")]),_._v("\n审核通过->审核通过 "),e("code",[_._v("之前记录无ref_ed,将原记录删除 并按渠道新增多条")])]),_._v(" "),e("p",[_._v("再次提交->升级中 "),e("code",[_._v("多条原记录，有ref_ed,设置ref_ing")]),_._v("\n暂不支持->审核失败 "),e("code",[_._v("之前记录有ref_ed,将原记录删除 并按渠道新增多条")]),_._v("\n审核通过->审核通过 "),e("code",[_._v("之前记录有ref_ed,将原记录删除 并按渠道新增多条")])]),_._v(" "),e("h1",{attrs:{id:"_5-判断字段是否为空-用-is-null-而不是-null"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-判断字段是否为空-用-is-null-而不是-null"}},[_._v("#")]),_._v(" 5. 判断字段是否为空 用 "),e("code",[_._v("is NULL")]),_._v(" 而不是 "),e("code",[_._v("=NULL")])]),_._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[_._v("按role_id分组，多列合为一个字段，以&分割，每个元素包括id#name")])]),_._v(" "),e("p",[e("code",[_._v("SELECT GROUP_CONCAT(CONCAT_WS('#',id,name) SEPARATOR '&') from user GROUP BY role_id")])]),_._v(" "),e("ol",{attrs:{start:"7"}},[e("li",[_._v("联表删除，删除role表和user表中id=1的记录")])]),_._v(" "),e("p",[e("code",[_._v("DELETE ROLE,USER from ROLE,USER where user.role_id=role.id and role.id=1")])]),_._v(" "),e("p",[_._v("这是全连接的方式，如果role表存在数据，user表不存在数据，删除就会失败。")]),_._v(" "),e("p",[_._v("采用左连接的方式，\n"),e("code",[_._v("DELETE ROLE,USER from ROLE LEFT JOIN USER ON user.role_id=role.id where and role.id=1")])]),_._v(" "),e("ol",{attrs:{start:"8"}},[e("li",[_._v("NOT IN 和 is NULL 一起用")])]),_._v(" "),e("p",[_._v("字段a的某条记录为NULL，而 a NOT IN (1,2,3) 不能得到该记录，应该是  a NOT IN (1,2,3) OR a is NULL")])])}),[],!1,null,null,null);e.default=a.exports}}]);