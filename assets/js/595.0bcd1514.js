(window.webpackJsonp=window.webpackJsonp||[]).push([[595],{1517:function(t,s,a){"use strict";a.r(s);var e=a(30),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("本篇文章将介绍个人博客搭建时，几种常用的评论方案，以及遇到的坑")]),t._v(" "),s("h1",{attrs:{id:"主流的几种评论方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主流的几种评论方案"}},[t._v("#")]),t._v(" 主流的几种评论方案")]),t._v(" "),s("h2",{attrs:{id:"gitalk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitalk"}},[t._v("#")]),t._v(" gitalk")]),t._v(" "),s("p",[t._v("采用 github issue 作为评论内容")]),t._v(" "),s("h3",{attrs:{id:"vuepress-使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vuepress-使用方式"}},[t._v("#")]),t._v(" vuepress 使用方式")]),t._v(" "),s("p",[t._v("在 vuepress 中使用 vuepress-plugin-comment 进行配置，底层是采用的 gitalk npm 包")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      'vuepress-plugin-comment'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 评论")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        choosen"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'gitalk'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          clientID"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ''"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          clientSecret"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ''"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          repo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'blog-gitalk-comment'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GitHub 仓库")]),t._v("\n          owner"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'francecil'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GitHub仓库所有者")]),t._v("\n          admin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("'francecil'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对仓库有写权限的人")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// gitalk 跨域代理问题可以看这个帖子 https://prohibitorum.top/7cc2c97a15b4.html")]),t._v("\n          proxy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//safe-cors-server.vercel.app//github_access_token',")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// distractionFreeMode: true,")]),t._v("\n          pagerDirection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'last'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'first'正序 | 'last'倒序")]),t._v("\n          id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" '<%- (frontmatter.permalink || frontmatter.to.path).slice("),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-16")]),t._v(") %>'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  页面的唯一标识,长度不能超过50")]),t._v("\n          title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" '「评论」<%- frontmatter.title %>'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GitHub issue 的标题")]),t._v("\n          labels"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("'Gitalk'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'Comment'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GitHub issue 的标签")]),t._v("\n          body"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            '页面：<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GitHub issue 的内容")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br")])]),s("h3",{attrs:{id:"存在的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存在的问题"}},[t._v("#")]),t._v(" 存在的问题")]),t._v(" "),s("ul",[s("li",[t._v("默认的跨域中转服务被墙，需要自建代理，参考 https://prohibitorum.top/7cc2c97a15b4.html 基于 vercel 快速搭建一个免费的服务")]),t._v(" "),s("li",[t._v("默认未创建 issue，需要写个脚本在部署服务时批量创建，若某篇文章已创建则跳过")]),t._v(" "),s("li",[t._v("配置的权限过于松散，且明文配置在页面中，可能有安全风险（？）")])]),t._v(" "),s("h2",{attrs:{id:"utterances-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utterances-使用"}},[t._v("#")]),t._v(" utterances 使用")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/utterance/",target:"_blank",rel:"noopener noreferrer"}},[t._v("utterance"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("采用 github issue 作为评论内容，与 gitalk 不同的是， utterances 提供了一个中间服务和 github app 来鉴权，安全性会更好一点。")]),t._v(" "),s("p",[t._v("同时由于无需配置密钥，用户接入成本很低，博客也无需提前创建 github issue")]),t._v(" "),s("h3",{attrs:{id:"使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),s("ol",[s("li",[t._v("新建评论仓库")]),t._v(" "),s("li",[t._v("打开 "),s("a",{attrs:{href:"https://github.com/apps/utterances",target:"_blank",rel:"noopener noreferrer"}},[t._v("utterances github app"),s("OutboundLink")],1),t._v(" ，为其授予新建评论仓库的权限")]),t._v(" "),s("li",[t._v("在页面中插件 utterances 的脚本")])]),t._v(" "),s("p",[t._v("对于 vuepress 仓库，可以参考 https://github.com/francecil/blog/tree/master/docs/.vuepress/plugins/commemt 这边的代码，后续会抽成 npm 包")]),t._v(" "),s("h3",{attrs:{id:"存在的问题-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存在的问题-2"}},[t._v("#")]),t._v(" 存在的问题")]),t._v(" "),s("ul",[s("li",[t._v("基于 iframe 展示评论，加载速度和性能相对 gitalk 较差，同时页面主题色同步需要一些 iframe 通信的成本。")]),t._v(" "),s("li",[t._v("依赖 utterances 服务，若 utterances 服务关闭则无法使用。")])]),t._v(" "),s("blockquote",[s("p",[t._v("不过数据不会丢失（存在 github issues 中），同时 utterances 也提供了 utterances-oauth 自部署服务的方案")])]),t._v(" "),s("h3",{attrs:{id:"utterances-原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utterances-原理"}},[t._v("#")]),t._v(" utterances 原理")]),t._v(" "),s("p",[t._v("见 https://lipk.org/blog/2020/06/08/run-utterances/")]),t._v(" "),s("h3",{attrs:{id:"讲下-beaudar"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#讲下-beaudar"}},[t._v("#")]),t._v(" 讲下 beaudar")]),t._v(" "),s("p",[t._v("国产版本：https://beaudar.lipk.org/ ，访问速度更快，支持了一些新功能")]),t._v(" "),s("blockquote",[s("p",[t._v("注意分支配置，新建的插件默认是 main 分支，beaudar 默认是 master 分支")])]),t._v(" "),s("p",[t._v("使用的时候一直鉴权报错，估计是 beaudar 服务维护问题，暂时放弃使用")])])}),[],!1,null,null,null);s.default=n.exports}}]);