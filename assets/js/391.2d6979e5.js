(window.webpackJsonp=window.webpackJsonp||[]).push([[391],{1285:function(a,e,t){"use strict";t.r(e);var r=t(30),n=Object(r.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("blockquote",[e("p",[a._v("源码未看完，先占坑")])]),a._v(" "),e("p",[a._v("每个Thread维护一个ThreadLocalMap")]),a._v(" "),e("h2",{attrs:{id:"获取threadlocalmap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取threadlocalmap"}},[a._v("#")]),a._v(" 获取ThreadLocalMap")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[a._v("/**\n     * Get the map associated with a ThreadLocal. Overridden in\n     * InheritableThreadLocal.\n     *\n     * @param  t the current thread\n     * @return the map\n     */    \nThreadLocalMap getMap(Thread t) {\n            return t.threadLocals;\n        }\n")])])]),a._v(" "),e("h2",{attrs:{id:"获取threadlocal实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取threadlocal实例"}},[a._v("#")]),a._v(" 获取ThreadLocal实例")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[a._v("/**\n     * Returns the value in the current thread's copy of this\n     * thread-local variable.  If the variable has no value for the\n     * current thread, it is first initialized to the value returned\n     * by an invocation of the {@link #initialValue} method.\n     *\n     * @return the current thread's value of this thread-local\n     */\n    public T get() {\n        Thread t = Thread.currentThread();\n        ThreadLocalMap map = getMap(t);//先获取当前线程维护的ThreadLocalMap\n        if (map != null) {\n            //this:外部的ThreadLocal(如ThreadLocal<Session> stl;stl.get())那么该this就是该ThreadLocal对象stl;\n            //Entry<key:this对象指向的ThreadLocal对象,value:我们所设置的对象，这里是Session>\n            ThreadLocalMap.Entry e = map.getEntry(this);//得到该线程下map中的ThreadLocal对象stl\n            if (e != null) {\n                @SuppressWarnings(\"unchecked\")\n                T result = (T)e.value;\n                return result;\n            }\n        }\n        return setInitialValue();\n    }\n")])])]),e("h2",{attrs:{id:"设置threadlocal实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置threadlocal实例"}},[a._v("#")]),a._v(" 设置ThreadLocal实例")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[a._v("/**\n     * Sets the current thread's copy of this thread-local variable\n     * to the specified value.  Most subclasses will have no need to\n     * override this method, relying solely on the {@link #initialValue}\n     * method to set the values of thread-locals.\n     *\n     * @param value the value to be stored in the current thread's copy of\n     *        this thread-local.\n     */\n    public void set(T value) {\n        Thread t = Thread.currentThread();\n        ThreadLocalMap map = getMap(t);\n        if (map != null)\n            map.set(this, value);\n        else\n            createMap(t, value);//不存在map,则创建该线程绑定的一个map\n    }\n")])])]),e("h2",{attrs:{id:"jdk1-4后用weakreference的好处"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jdk1-4后用weakreference的好处"}},[a._v("#")]),a._v(" JDK1.4后用WeakReference的好处")]),a._v(" "),e("p",[a._v("不知道ThreadLocal干嘛用的，参考")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[a._v("http://www.iteye.com/topic/103804\n[荐]http://qifuguang.me/2015/09/02/[Java%E5%B9%B6%E5%8F%91%E5%8C%85%E5%AD%A6%E4%B9%A0%E4%B8%83]%E8%A7%A3%E5%AF%86ThreadLocal/\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);