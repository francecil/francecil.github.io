(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{942:function(t,r,a){"use strict";a.r(r);var e=a(27),v=Object(e.a)({},(function(){var t=this,r=t._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"疑问"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#疑问"}},[t._v("#")]),t._v(" 疑问")]),t._v(" "),r("p",[t._v("检测更新的时机是？")]),t._v(" "),r("h2",{attrs:{id:"安装失败终止流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装失败终止流程"}},[t._v("#")]),t._v(" 安装失败终止流程")]),t._v(" "),r("h2",{attrs:{id:"开发"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#开发"}},[t._v("#")]),t._v(" 开发")]),t._v(" "),r("p",[t._v("webpack 通过 "),r("a",{attrs:{href:"https://developers.google.com/web/tools/workbox/modules/workbox-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("workbox-webpack-plugin"),r("OutboundLink")],1),t._v(" 生成 sw")]),t._v(" "),r("p",[t._v("可以配置")]),t._v(" "),r("p",[t._v("update on reload")]),t._v(" "),r("h2",{attrs:{id:"更新时机"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#更新时机"}},[t._v("#")]),t._v(" 更新时机")]),t._v(" "),r("p",[t._v("被动更新和主动更新")]),t._v(" "),r("ul",[r("li",[t._v("被动更新：超过时间，或者浏览器相关都关掉然后打开新页面，就会触发更新")])]),t._v(" "),r("blockquote",[r("p",[t._v("受限于浏览器设计，只有一个 tab 的 reload 也不会触发更新")])]),t._v(" "),r("ul",[r("li",[t._v("主动更新：主动调用 skipWaiting 接管页面")])]),t._v(" "),r("h3",{attrs:{id:"主动更新的三种策略"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#主动更新的三种策略"}},[t._v("#")]),t._v(" 主动更新的三种策略")]),t._v(" "),r("ul",[r("li",[t._v("静默接管")]),t._v(" "),r("li",[t._v("立即刷新")]),t._v(" "),r("li",[t._v("提示刷新")])]),t._v(" "),r("hr"),t._v(" "),r("p",[t._v("url hash 变更 sw.js?v=111")]),t._v(" "),r("p",[t._v("sw 内容变更")]),t._v(" "),r("p",[t._v("skipWaiting 阶段")]),t._v(" "),r("ul",[r("li",[t._v("手动点击 skipWaiting")]),t._v(" "),r("li",[t._v("关闭所有终端")]),t._v(" "),r("li",[t._v("代码里设置 self.skipWaiting()")])]),t._v(" "),r("p",[t._v("https://lavas-project.github.io/pwa-book/chapter04/3-service-worker-dive.html")]),t._v(" "),r("p",[t._v("另外默认 24 小时触发更新")]),t._v(" "),r("h2",{attrs:{id:"参考资料"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://juejin.cn/post/6844903792522035208",target:"_blank",rel:"noopener noreferrer"}},[t._v("谨慎处理 Service Worker 的更新"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);r.default=v.exports}}]);