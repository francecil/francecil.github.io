(window.webpackJsonp=window.webpackJsonp||[]).push([[345],{1237:function(v,_,a){"use strict";a.r(_);var t=a(30),s=Object(t.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("在视频创作业务中，经常会收到作者发文反馈，可以归结为以下三种：")]),v._v(" "),_("ol",[_("li",[v._v("上传失败")]),v._v(" "),_("li",[v._v("发文失败")]),v._v(" "),_("li",[v._v("转码异常")])]),v._v(" "),_("p",[v._v("在此做下记录，包括 "),_("code",[v._v("问题描述、原因分析、解决方案")]),v._v("，方便后续建设"),_("strong",[v._v("体系化、自动化、可复用")]),v._v("的排障方案，同时也可复用这套经验到其他视频发文业务。")]),v._v(" "),_("h2",{attrs:{id:"q1-上传失败"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#q1-上传失败"}},[v._v("#")]),v._v(" Q1: 上传失败")]),v._v(" "),_("p",[v._v("作者在上传视频过程中，提示上传失败，且重试上传后依然失败")]),v._v(" "),_("h3",{attrs:{id:"原因分析"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#原因分析"}},[v._v("#")]),v._v(" 原因分析")]),v._v(" "),_("p",[v._v("排查问题前首先需要了解 Web 的上传流程以及请求链路")]),v._v(" "),_("p",[v._v("Web 上传流程如下：")]),v._v(" "),_("ol",[_("li",[v._v("获取上传信息，包括上传域名和上传签名")]),v._v(" "),_("li",[v._v("初始化分片信息")]),v._v(" "),_("li",[v._v("分片上传")]),v._v(" "),_("li",[v._v("合并分片并上传存储服务")]),v._v(" "),_("li",[v._v("确认上传成功，生成唯一 ID（vid）")])]),v._v(" "),_("ul",[_("li",[v._v("对于步骤 1 和 5，请求链路为：端 SDK -> 加速 CDN -> 源站服务")]),v._v(" "),_("li",[v._v("对于步骤 2 ~ 4，请求链路为：端 SDK -> 加速 CDN -> 中心/边缘节点 -> 存储服务")])]),v._v(" "),_("p",[v._v("如果出现上传失败，可能的链路就这三种：")]),v._v(" "),_("ol",[_("li",[v._v("用户端：文件 IO 或者自身网络问题")]),v._v(" "),_("li",[v._v("网络链路：CDN 节点或者地区运营商线路问题，比如域名解析或建联失败、节点故障")]),v._v(" "),_("li",[v._v("服务端：IP 限流、非法请求（签名无效、参数缺失）、服务故障（网络、IO、崩溃）")])]),v._v(" "),_("h3",{attrs:{id:"解决方案"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[v._v("#")]),v._v(" 解决方案")]),v._v(" "),_("p",[v._v("后台会自动收集上传错误信息（公司内部服务），可以根据错误码快速判断哪个环节出了哪种故障。")]),v._v(" "),_("p",[v._v("若未上报错误信息，则判定用户网络不通，提示用户 "),_("code",[v._v("更换网络或关闭代理后重试")]),v._v("。")]),v._v(" "),_("p",[v._v("若收到错误信息，根据错误码判断出错的链路是在哪个环节：")]),v._v(" "),_("ol",[_("li",[v._v("如果是用户端，除了网络外还有 IO 问题，IO 问题通常是文件分片大小大于剩余内存，可以先检查分片策略是否合理，若不合理则及时调整并修复上线，否则提示用户 "),_("code",[v._v("先清理内存再重试")])]),v._v(" "),_("li",[v._v("如果是网络链路，说明内部的异常自动切换选路也失败了，需要指定用户下发特定可用的网络节点（接口控制），并提示用户 "),_("code",[v._v("刷新页面后重试")]),v._v("。同时观察相应地区、域名及运营商的大盘数据是否波动，错误码是否集中，若是的话联系 CDN 同学处理。")]),v._v(" "),_("li",[v._v("如果是端问题，则分情况处理\n"),_("ol",[_("li",[v._v("如果是非法请求，说明是灰产用户，无需处理")]),v._v(" "),_("li",[v._v("如果是 IP 限流，说明命中风控，判定用户非灰产的情况下可以联系风控平台解除 IP 限制，并 "),_("code",[v._v("提示用户重试")])]),v._v(" "),_("li",[v._v("如果是服务故障，联系相关服务同学排查，修复后 "),_("code",[v._v("提示用户重试")])])])])]),v._v(" "),_("h2",{attrs:{id:"q2-发文失败"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#q2-发文失败"}},[v._v("#")]),v._v(" Q2: 发文失败")]),v._v(" "),_("p",[v._v("作品完成上传，但在点击发布的时候提示发文失败")]),v._v(" "),_("h3",{attrs:{id:"原因分析-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#原因分析-2"}},[v._v("#")]),v._v(" 原因分析")]),v._v(" "),_("p",[v._v("一般是这两种情况：")]),v._v(" "),_("ol",[_("li",[v._v("用户账号问题，比如命中风控，或账号权限不足")]),v._v(" "),_("li",[v._v("发文服务端异常")])]),v._v(" "),_("h3",{attrs:{id:"解决方案-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-2"}},[v._v("#")]),v._v(" 解决方案")]),v._v(" "),_("p",[v._v("查询相关用户的发文失败日志")]),v._v(" "),_("ol",[_("li",[v._v("如果是风险账号，无需处理")]),v._v(" "),_("li",[v._v("如果是账号权限不足，则把 "),_("code",[v._v("权限不足的具体描述透传用户")]),v._v(" ，比如 "),_("em",[v._v("非万粉无法发一小时以上视频")])]),v._v(" "),_("li",[v._v("如果是服务端异常，联系相关服务同学排查，修复后 "),_("code",[v._v("提示用户重试")])])]),v._v(" "),_("h2",{attrs:{id:"q3-转码异常"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#q3-转码异常"}},[v._v("#")]),v._v(" Q3: 转码异常")]),v._v(" "),_("p",[v._v("作品发布后，视频在后台转码过程中出现异常。")]),v._v(" "),_("blockquote",[_("p",[v._v("转码的目的是将不同格式的视频统一转码成平台标准格式，并提供不同分辨率的资源")])]),v._v(" "),_("h3",{attrs:{id:"原因分析-3"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#原因分析-3"}},[v._v("#")]),v._v(" 原因分析")]),v._v(" "),_("p",[v._v("作者的视频源文件存在问题，被转码服务拦截了，一般是这三种原因：")]),v._v(" "),_("ol",[_("li",[v._v("灰产恶意编辑视频源文件数据，比如修改文件头的视频时长，把长视频改成短时长想要绕过平台的一些审核流程")]),v._v(" "),_("li",[v._v("作者剪辑视频出现误操作，导致视频不符合平台规范，比如平均帧率低于阈值（10fps）、视频时间戳跳变过大")]),v._v(" "),_("li",[v._v("剪辑软件的问题，导出生成视频文件时出现 bug，比如文件头数据与实际数据不统一")])]),v._v(" "),_("h3",{attrs:{id:"解决方案-3"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-3"}},[v._v("#")]),v._v(" 解决方案")]),v._v(" "),_("ol",[_("li",[v._v("若作者未删除视频，可以在诊断平台（公司内部平台）上找到源文件，使用一键诊断分析原因")]),v._v(" "),_("li",[v._v("否则可以让作者提供视频源文件，在本地执行 FFmpeg 的 ffprobe 命令进行诊断")])]),v._v(" "),_("div",{staticClass:"language-sh line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-sh"}},[_("code",[v._v("ffprobe test.mp4\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br")])]),_("p",[v._v("得到诊断结果：")]),v._v(" "),_("ul",[_("li",[v._v("如果是恶意编辑，无需处理")]),v._v(" "),_("li",[v._v("如果是误操作，则 "),_("code",[v._v("提示用户具体需要修改的地方")])]),v._v(" "),_("li",[v._v("如果是剪辑软件问题，则 "),_("code",[v._v("提示用户重新导出")])])])])}),[],!1,null,null,null);_.default=s.exports}}]);