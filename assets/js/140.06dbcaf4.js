(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{871:function(s,t,a){"use strict";a.r(t);var n=a(27),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"commonjs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commonjs"}},[s._v("#")]),s._v(" CommonJS")]),s._v(" "),t("p",[s._v("node 中对文件进行加载，使用自己的一套包装机制（底层还是用的 es5 js 那套，没有新语法糖）")]),s._v(" "),t("p",[s._v("同步加载并执行模块文件")]),s._v(" "),t("p",[s._v("require 加载源码，看完差不多就懂加载过程了")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// id 为路径标识符")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 查找  Module 上有没有已经加载的 js  对象*/")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v("  cachedModule "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   \n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 如果已经加载了那么直接取走缓存的 exports 对象  */")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cachedModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cachedModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 创建当前模块的 module  */")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" module "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("exports")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loaded")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 将 module 缓存到  Module 的缓存属性中，路径标识符作为 id */")]),s._v("  \n  Module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" module\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 加载文件 */")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runInThisContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wrapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'module.exports = \"123\"'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __filename"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" __dirname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 加载完成 */")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n  module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loaded "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 返回值 */")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("模块id放缓存-》初始化-》加载文件-》返回值")]),s._v(" "),t("p",[s._v('一旦出现某个模块被"循环加载"，就只输出已经执行的部分(那一刻的 exports 的值)')]),s._v(" "),t("p",[s._v("因此:")]),s._v(" "),t("ol",[t("li",[s._v("多次 require 引入同一个文件，实际都是引用的同一个 "),t("code",[s._v("module.exports")]),s._v(" 对象，故某个地方进行修改会影响其他地方的访问值")]),s._v(" "),t("li")]),s._v(" "),t("h2",{attrs:{id:"es-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#es-module"}},[s._v("#")]),s._v(" Es Module")]),s._v(" "),t("p",[s._v("es6 语法，编译时就确定好了")]),s._v(" "),t("p",[s._v("自动提升到顶部")]),s._v(" "),t("p",[s._v("import 使用总结：")]),s._v(" "),t("ul",[t("li",[s._v("导入的属性只读，相对于 const , 无论其是否为基础类型")]),s._v(" "),t("li",[s._v("import 的模块运行在严格模式下")]),s._v(" "),t("li",[s._v("导入的变量始终是一个引用，和原变量绑定在一起，无论其是否为基础类型")])]),s._v(" "),t("p",[s._v("底层处理的，不是 es5 可以实现的")]),s._v(" "),t("p",[s._v("循环加载的处理：认为引用的模块都是导出好了的，结果在实际执行时使用了尚未导出的引用模块的方法，导致报 undefined")]),s._v(" "),t("h2",{attrs:{id:"文章推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文章推荐"}},[s._v("#")]),s._v(" 文章推荐")]),s._v(" "),t("p",[s._v("https://mp.weixin.qq.com/s/y_uk7wXAfvq8FzcUZrR93w")])])}),[],!1,null,null,null);t.default=e.exports}}]);