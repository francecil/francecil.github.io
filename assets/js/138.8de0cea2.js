(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{1021:function(s,t,a){"use strict";a.r(t);var e=a(30),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"hint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hint"}},[s._v("#")]),s._v(" hint")]),s._v(" "),t("p",[s._v("发现 linux or macos 上调试 v8 较麻烦，后面直接调试 JavaScriptCore 了")]),s._v(" "),t("p",[s._v("win 上可以用 vs 调试，后面有机会可以看看")]),s._v(" "),t("h2",{attrs:{id:"需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),t("p",[s._v("看懂 js 方法里的某些原生实现一直是我的梦想，正好最近有个契机，看了网上很多文章，总结的技巧")]),s._v(" "),t("p",[s._v("调试某个方法，可以看到每个 v8 中执行的每一步")]),s._v(" "),t("p",[s._v("时效性")]),s._v(" "),t("h2",{attrs:{id:"下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[s._v("#")]),s._v(" 下载")]),s._v(" "),t("p",[s._v("官方文档： https://v8.dev/docs/source-code")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进一个你要测试的目录，后面拉的工具和代码都放此目录下, 测试机我直接放 ~ 了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /path/to/your_test_dir\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":~/depot_tools\ngclient config https://chromium.googlesource.com/v8/v8\ngclient "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 又拉了一遍？ 这个步骤应该不需要")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ~/v8\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/v8\nfetch v8\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" v8\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# linux 上需要执行此步骤，下载依赖")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./build/install-build-deps.sh\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据提示安装某些安装包?执行以下命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configure")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("macOS 坑")]),s._v(" "),t("p",[s._v("xcode-select: error: tool 'xcodebuild' requires Xcode, but active developer directory '/Library/Developer/CommandLineTools' is a command line tools instance")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://stackoverflow.com/questions/17980759/xcode-select-active-developer-directory-error",target:"_blank",rel:"noopener noreferrer"}},[s._v("xcode-select active developer directory error"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[s._v("#")]),s._v(" 编译")]),s._v(" "),t("p",[s._v("https://v8.dev/docs/build")]),s._v(" "),t("p",[s._v("官方文档见 https://v8.dev/docs/build-gn")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/Users/bytedance/Repos/test/depot_tools:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# alias gm=/path/to/v8/tools/dev/gm.py")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gm")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v("/v8/tools/dev/gm.py\ngm x64.release\ngm x64.release.check\ngm x64.debug\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"debug"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#debug"}},[s._v("#")]),s._v(" debug")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 d8 输出运行结果（类似 node）")]),s._v("\n./out/x64.debug/d8  test.js\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者先进入 d8 ,可以执行 js 代码")]),s._v("\n./out/x64.debug/d8\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 gdb 调试  -q:不带版本号等无用输出")]),s._v("\ngdb "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" ./out/x64.debug/d8\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意需要指定这个！?")]),s._v("\ngdb "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" ./out/x64.debug/d8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" ./tools/gdbinit \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主功能汇编代码?")]),s._v("\ndisassemble main\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 gdb debug test.js")]),s._v("\nr "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--allow_natives_syntax")]),s._v(" ./test.js\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看内存")]),s._v("\nx/gx "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elements内存地址"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置断点")]),s._v("\nb v8::base::ieee754::cosh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h2",{attrs:{id:"v8-基础知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v8-基础知识"}},[s._v("#")]),s._v(" v8 基础知识")]),s._v(" "),t("p",[s._v("Iso")]),s._v(" "),t("h2",{attrs:{id:"实例分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例分析"}},[s._v("#")]),s._v(" 实例分析")]),s._v(" "),t("h2",{attrs:{id:"vscode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vscode"}},[s._v("#")]),s._v(" vscode")]),s._v(" "),t("p",[s._v("安装相关插件：C/C++ Clang，C++ Intellisense，C/C++\n配置launch.json，当中配置成gdb即可")]),s._v(" "),t("p",[s._v("https://v8.dev/docs/ide-setup")]),s._v(" "),t("p",[s._v("只看代码分析，支持跳转")]),s._v(" "),t("p",[s._v("https://source.chromium.org/chromium/chromium/src/+/master:v8")]),s._v(" "),t("h2",{attrs:{id:"参考文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://v8.dev/docs",target:"_blank",rel:"noopener noreferrer"}},[s._v("v8 docs"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("https://www.youtube.com/watch?v=HimbmR7e4dk")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://www.lichen.in/2018/11/21/v8-shi-yong-vs-code/",target:"_blank",rel:"noopener noreferrer"}},[s._v("[V8]使用VS Code调试V8代码"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://juejin.im/post/5cc5141ce51d456e3e7a3be2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js 调试 源码"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://v8.dev/docs/build",target:"_blank",rel:"noopener noreferrer"}},[s._v("V8代码编译"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);